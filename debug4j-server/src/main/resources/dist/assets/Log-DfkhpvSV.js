import{w as y,g as k}from"./webStorage-CD_LUw1r.js";import{_ as I,R as v,r as b,f as n,B as U,c as w,w as c,e as s,o as x,b as e,d as m,t as C}from"./index-8ZpJtw8L.js";/* empty css                */const B={components:{Codemirror:v},setup(){y.getItem("token")===void 0&&b.push("/login");const t=n(""),_=n(""),o=n(""),S={mode:"log",theme:"darcula",readOnly:!0},r=n(!0),d=n(!0),h=n(0),l=n(0),u=(p,a)=>{d.value?(a.scrollTo(h.value,a.getScrollInfo().height+a.getScrollInfo().top),l.value=a.getScrollInfo().top):a.scrollTo(h.value,l.value)},g=p=>{d.value||(l.value=p.getScrollInfo().top),h.value=p.getScrollInfo().left},f=n();return{clientSessionId:t,filePath:_,code:o,cmOptions:S,es:f,codeUpdate:r,codeScroll:d,onChange:u,onScroll:g}},data(){return{}},methods:{loadLog(){this.es=new EventSource(k.baseURL+"/attach/task?path="+this.filePath+"&sessionId="+this.clientSessionId+"&token="+y.getItem("token")+"&loginId="+y.getItem("loginId")),this.es.onmessage=i=>{this.codeUpdate&&(this.code+=`${i.data}
`)},this.es.onerror=()=>{this.es.close()}},codeUpdateChange(){this.codeUpdate&&(this.code+=`${U(" 日志更新截至："+this.formatTime(new Date)+" ")}
`),this.codeUpdate=!this.codeUpdate},codeScrollChange(){this.codeScroll=!this.codeScroll},codeClear(){this.code=""},formatTime(i){const t={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};return i.toLocaleString("zh-CN",t)}},mounted(){this.clientSessionId=this.$route.query.clientSessionId,this.filePath=this.$route.query.filePath,this.loadLog()},beforeDestroy(){this.es&&this.es.close()}};function L(i,t,_,o,S,r){const d=s("Codemirror"),h=s("lay-body"),l=s("lay-icon"),u=s("lay-button"),g=s("lay-panel"),f=s("lay-footer"),p=s("lay-layout");return x(),w(p,null,{default:c(()=>[e(h,{style:{height:"100%"}},{default:c(()=>[e(d,{id:"logBox",value:o.code,"onUpdate:value":t[0]||(t[0]=a=>o.code=a),options:o.cmOptions,onChange:o.onChange,onScroll:o.onScroll,height:"99.6%"},null,8,["value","options","onChange","onScroll"])]),_:1}),e(f,null,{default:c(()=>[e(g,{style:{"margin-bottom":"5px","background-color":"#333"}},{default:c(()=>[e(u,{onClick:r.codeUpdateChange,type:o.codeUpdate?"warm":"primary"},{default:c(()=>[e(l,{type:"layui-icon-refresh"}),m(" "+C(o.codeUpdate?"关闭":"开启")+"更新 ",1)]),_:1},8,["onClick","type"]),e(u,{onClick:r.codeScrollChange,type:o.codeScroll?"warm":"primary"},{default:c(()=>[e(l,{type:"layui-icon-slider"}),m(" "+C(o.codeScroll?"关闭":"开启")+"滚动 ",1)]),_:1},8,["onClick","type"]),e(u,{onClick:r.codeClear,type:"danger"},{default:c(()=>[e(l,{type:"layui-icon-delete"}),t[1]||(t[1]=m(" 清空日志 "))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})}const N=I(B,[["render",L]]);export{N as default};
